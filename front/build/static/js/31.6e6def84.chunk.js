(this.webpackJsonpapibase=this.webpackJsonpapibase||[]).push([[31],{406:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(4),o=a.n(c),s=a(10),l=a(12),i=a(43),u=a.n(i),m=a(76),d=a(21),b=a(169),f=a(98),p=a(471),g=a(13),E=a(395),h=a.n(E),v=a(120),O=a(14),j=a(11),N=a(33),I=a.n(N),x=a(34),y=a.n(x),Y=a(19),S=a(16),w=function(e){e.setshowListGasto;var t=e.listGastos,a=void 0===t?[]:t,c=e.setListGastos,i=(e.listCategorias,e.listSubCategorias,e.handleEditar),u=e.setLoading,b=Object(Y.a)({fechaFinal:"",fechaInicial:""}),f=Object(l.a)(b,2),p=(f[0],f[1],Object(n.useState)(!1)),E=Object(l.a)(p,2),h=E[0],N=(E[1],Object(n.useState)(!1)),x=Object(l.a)(N,2);x[0],x[1];return r.a.createElement(r.a.Fragment,null,h?r.a.createElement(r.a.Fragment,null):r.a.createElement(g.a,null,r.a.createElement(m.a,null,r.a.createElement(d.a,null,r.a.createElement(v.a,{responsive:!0,hover:!0,borderless:!0},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"No."),r.a.createElement("th",null,"Categor\xeda"),r.a.createElement("th",null,"Sub-Categor\xeda"),r.a.createElement("th",null,"Descripci\xf3n"),r.a.createElement("th",{style:{textAlign:"center"}},"Monto"),r.a.createElement("th",{style:{textAlign:"center"}},"Fecha"),r.a.createElement("th",{style:{textAlign:"center"}},"Opciones"))),r.a.createElement("tbody",null,a&&a.map((function(e,t){return r.a.createElement("tr",{key:"gastoId".concat(e.gastoId)},r.a.createElement("td",null,t+1),r.a.createElement("td",null,null===e||void 0===e?void 0:e.categoria),r.a.createElement("td",null,null===e||void 0===e?void 0:e.subcategora),r.a.createElement("td",null,null===e||void 0===e?void 0:e.descripcion),r.a.createElement("td",{style:{textAlign:"center"}},"Q",e.monto),r.a.createElement("td",{style:{textAlign:"center"}},null===e||void 0===e?void 0:e.fecha_crea),r.a.createElement("td",{style:{textAlign:"center"}},r.a.createElement("a",{href:"#",onClick:function(){i(e.gastoId)}},r.a.createElement("i",{className:"icon feather icon-edit f-w-600 f-16 m-r-15 text-c-green"})),r.a.createElement("a",{href:"#",onClick:function(){var t;t=e.gastoId,y()(I.a).fire({title:"Alerta?",text:"Esta seguro que desea eliminar el elemento",type:"warning",showCloseButton:!0,showCancelButton:!0}).then(function(){var e=Object(s.a)(o.a.mark((function e(n){var r,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.value){e.next=10;break}return u(!0),e.next=5,Object(O.a)("ctl/gasto/".concat(t),{method:"DELETE"});case 5:(r=e.sent)&&(Object(j.b)(r),s=a.filter((function(e){return e.gastoId!==t})),c(s)),u(!1),e.next=11;break;case 10:Object(j.d)("No se elimin\xf3 ning\xfan elemento");case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},r.a.createElement("i",{className:"feather icon-trash-2 f-w-600 f-16 text-c-red"}))))}))))))))},M=a(463),F=a(28),C=a(8),k=a(144),D=function(e){var t=e.dataInicial,a=e.setRefreshData,c=e.abrirModal,i=e.setAbrirModal,u=(e.GetCategorias,e.listCategorias),m=e.listSubCategorias,b=Object(Y.a)(t),f=Object(l.a)(b,2),p=f[0],g=f[1],E=Object(n.useState)([]),h=Object(l.a)(E,2),v=h[0],N=h[1],I=Object(n.useState)(!1),x=Object(l.a)(I,2),y=x[0],w=x[1],D=Object(n.useState)(!1),G=Object(l.a)(D,2),L=G[0],A=G[1],P=function(){var e=Object(s.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(O.a)("ctl/gasto",{method:"POST",body:JSON.stringify(p)});case 2:e.sent&&(a(Object(k.v4)()),Object(j.b)("Gasto agregado exitosamente"),i(!1));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=Object(s.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(O.a)("ctl/gasto",{method:"PUT",body:JSON.stringify(p)});case 2:(t=e.sent)&&(a(Object(k.v4)()),Object(j.b)(t)),i(!1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=Object(s.a)(o.a.mark((function e(a){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),A(!0),!(t.gastoId>0)){e.next=7;break}return e.next=5,_();case 5:e.next=9;break;case 7:return e.next=9,P();case 9:A(!1);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){if(p.categoriaId){var e=m.filter((function(e){return Number(e.categoriaId)===Number(p.categoriaId)}));e.length>0?(w(!0),N(e)):(w(!1),g({target:{name:"sub_categoriaId",value:"0"}}))}}),[p.categoriaId]);var T="Campo obligatorio";return r.a.createElement(M.a,{show:c,onHide:function(){return i(!1)}},!0===L?r.a.createElement(S.a,null):r.a.createElement(r.a.Fragment,null,r.a.createElement(M.a.Header,{closeButton:!0},r.a.createElement(M.a.Title,{as:"h5"},t.gastoId>0?"Actualizar Gasto":"Nuevo Gasto")),r.a.createElement(M.a.Body,null,r.a.createElement(C.ValidationForm,{onSubmit:B,onErrorSubmit:function(e,t,a){Object(j.d)("Por favor complete toda la informaci\xf3n solicitada por el formulario")}},r.a.createElement(F.a.Row,null,r.a.createElement(F.a.Group,{as:d.a,md:"12"},r.a.createElement(F.a.Label,{htmlFor:"categoriaId"},"Categor\xeda"),r.a.createElement(C.SelectGroup,{name:"categoriaId",id:"categoriaId",required:!0,onChange:g,value:p.categoriaId,errorMessage:T},r.a.createElement("option",{value:""},"--Seleccione--"),u.map((function(e){var t=e.categoriaId,a=e.nombre;return r.a.createElement("option",{value:t,key:t},a)})))),!0===y&&r.a.createElement(F.a.Group,{as:d.a,md:"12"},r.a.createElement(F.a.Label,{htmlFor:"sub_categoriaId"},"Sub-Categor\xeda"),r.a.createElement(C.SelectGroup,{name:"sub_categoriaId",id:"sub_categoriaId",required:!0,onChange:g,value:p.sub_categoriaId,errorMessage:T},r.a.createElement("option",{value:""},"--Seleccione--"),v.map((function(e){var t=e.sub_categoriaId,a=e.nombre;return r.a.createElement("option",{value:t,key:t},a)})))),r.a.createElement(F.a.Group,{as:d.a,md:"12"},r.a.createElement(F.a.Label,{htmlFor:"monto"},"Monto"),r.a.createElement(C.TextInput,{name:"monto",id:"monto",required:!0,value:p.monto,onChange:g,errorMessage:T,placeholder:"Monto",autoComplete:"off",type:"number"})),r.a.createElement(F.a.Group,{as:d.a,md:"12"},r.a.createElement(F.a.Label,{htmlFor:"descripcion"},"Descripci\xf3n"),r.a.createElement(C.TextInput,{name:"descripcion",id:"descripcion",value:p.descripcion,onChange:g,errorMessage:T,placeholder:"descripcion",autoComplete:"off",style:{textTransform:"capitalize"},type:"text"})),0===t.gastoId&&r.a.createElement(F.a.Group,{as:d.a,md:"12"},r.a.createElement(F.a.Label,{htmlFor:"estadoId"},"Estado"),r.a.createElement(C.SelectGroup,{name:"estadoId",id:"estadoId",value:p.estadoId,required:!0,errorMessage:T,onChange:g},r.a.createElement("option",{value:""},"Seleccione un estado"),r.a.createElement("option",{value:"1"},"Activo"),r.a.createElement("option",{value:"2"},"Inactivo")))),r.a.createElement(F.a.Row,{className:"align-items-center m-l-0"},r.a.createElement(d.a,null),r.a.createElement(d.a,null),r.a.createElement(d.a,{className:"text-right"},r.a.createElement("button",{type:"button",onClick:function(){i(!1)},className:"btn btn-warning"}," Cancelar")),r.a.createElement(d.a,{className:"text-right"},r.a.createElement("button",{type:"submit",className:"btn btn-success"}," ",t.gastoId>0?"Actualizar":"Registrar")))))))},G=function(){var e=Object(n.useState)(!0),t=Object(l.a)(e,2),a=t[0],c=t[1],i=Object(n.useState)(Object(k.v4)()),p=Object(l.a)(i,2),E=p[0],h=p[1],v=Object(n.useState)([]),j=Object(l.a)(v,2),N=j[0],I=j[1],x=Object(n.useState)([]),y=Object(l.a)(x,2),M=y[0],F=y[1],C=Object(n.useState)({gasto:0,presupuesto:0}),G=Object(l.a)(C,2),_=G[0],B=G[1],T=Object(n.useState)([]),q=Object(l.a)(T,2),H=q[0],Q=q[1],z=Object(n.useState)([]),J=Object(l.a)(z,2),R=J[0],U=J[1],V=Object(n.useState)(!1),K=Object(l.a)(V,2),W=K[0],X=K[1],Z=Object(n.useState)([]),$=Object(l.a)(Z,2),ee=$[0],te=$[1],ae=Object(n.useState)([]),ne=Object(l.a)(ae,2),re=ne[0],ce=ne[1],oe=Object(n.useState)(!1),se=Object(l.a)(oe,2),le=se[0],ie=se[1],ue={gastoId:"",categoriaId:"",sub_categoriaId:null,descripcion:"",monto:0,estadoId:1},me=Object(Y.a)({fechaInicial:u()("".concat((new Date).getFullYear(),"-").concat((new Date).getMonth()+1,"-01"),"YYYY-MM-DD").format("YYYY-MM-DD"),fechaFinal:u()(new Date,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD")}),de=Object(l.a)(me,2),be=de[0],fe=de[1],pe=Object(n.useState)(ue),ge=Object(l.a)(pe,2),Ee=ge[0],he=ge[1],ve=function(){var e=Object(s.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(O.a)("ctl/categoria?estadoId=1&include=0");case 2:(t=e.sent)&&te(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Oe=function(){var e=Object(s.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(O.a)("ctl/subcategoria?estadoId=1");case 2:(t=e.sent)&&ce(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){ve(),Oe(),Ne()}),[]);Object(n.useEffect)((function(){if(N.length>0){var e=function(e){var t=[],a=!0,n=!1,r=void 0;try{for(var c,o=function(){var e=c.value;t.find((function(t){return Number(t.id)===Number(e.id)}))||t.push(e)},s=e[Symbol.iterator]();!(a=(c=s.next()).done);a=!0)o()}catch(l){n=!0,r=l}finally{try{a||null==s.return||s.return()}finally{if(n)throw r}}return t}(N.map((function(e){return{id:e.categoriaId,descripcion:e.categoria}})));Q(e)}else Q([]),U([]),B({gasto:0,presupuesto:0})}),[N,M]),Object(n.useEffect)((function(){if(H.length>0){var e=0,t=0,a=H.map((function(a){var n=a.id,r=a.descripcion,c=0,o=0;return N.map((function(e){var t=e.categoriaId,a=e.monto;Number(t)===Number(n)&&(c+=Number(a))})),M.map((function(e){var t=e.categoriaId,a=e.monto;Number(t)===Number(n)&&(o+=Number(a))})),e+=Number(c),t+=Number(o),{id:Object(k.v4)(),categoria:r,presupuesto:Number(o).toFixed(2),gasto:Number(c).toFixed(2)}}));U(a),B({gasto:e,presupuesto:t})}else U([]),B({gasto:0,presupuesto:0})}),[H]);var je=function(){var e=Object(s.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ne();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ne=function(){var e=Object(s.a)(o.a.mark((function e(){var t,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(!0),e.next=3,Object(O.a)("ctl/gasto/list",{method:"POST",body:JSON.stringify(be)});case 3:(t=e.sent)&&(t.gastos.length>0?(a=t.gastos.map((function(e){return e.mesId=u()(e.fecha_crea,"YYYY-MM-DD").format("MM"),e.anioId=u()(e.fecha_crea,"YYYY-MM-DD").format("YYYY"),e})),I(a)):I([]),t.presupuesto.length>0?F((null===t||void 0===t?void 0:t.presupuesto)||[]):F([])),c(!1);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){Ne()}),[E]),r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,null,r.a.createElement(m.a,null,r.a.createElement(d.a,{xl:12,md:12},r.a.createElement(b.a,{className:"quater-card"},r.a.createElement(b.a.Header,null,r.a.createElement("h5",null,"Filtros")),r.a.createElement(b.a.Body,{className:"pb-0"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-3"},r.a.createElement("div",{className:"form-group col"},r.a.createElement("label",{className:"form-label"},"Fecha Inicial"),r.a.createElement("input",{type:"date",id:"fechaInicial",name:"fechaInicial",value:be.fechaInicial,onChange:fe,className:"form-control"}))),r.a.createElement("div",{className:"col-md-3"},r.a.createElement("div",{className:"form-group col"},r.a.createElement("label",{className:"form-label"},"Fecha Final"),r.a.createElement("input",{type:"date",id:"fechaFinal",name:"fechaFinal",value:be.fechaFinal,onChange:fe,className:"form-control"}))),r.a.createElement("div",{className:"col-md-3"},r.a.createElement("div",{className:"form-group col"},r.a.createElement("label",{className:"form-label"},"\xa0\xa0"),r.a.createElement("div",{className:"mb-3 input-group"},r.a.createElement("div",{className:"input-group-append"},r.a.createElement("button",{className:"btn btn-primary",onClick:function(){je()}},"Filtrar",r.a.createElement("i",{className:"feather icon-search"}))))))))))),!0===a?r.a.createElement(S.a,null):r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,null,r.a.createElement(d.a,{xl:12,md:12},r.a.createElement(b.a,{className:"quater-card"},r.a.createElement(b.a.Body,null,r.a.createElement("h6",{className:"text-muted m-b-15"},"Gastos ",r.a.createElement(f.a,{key:"btnBack",variant:"success",size:"sm",onClick:function(e){he(ue),ie(!0)}},"Add. +")),r.a.createElement("h5",null,"Q",Number(_.gasto).toFixed(2),"/Q",Number(_.presupuesto).toFixed(2)),R.length>0&&R.map((function(e){var t=e.id,a=e.categoria,n=e.presupuesto,c=e.gasto;return r.a.createElement(L,{texto:a,presupuesto:n,gasto:c,key:t})}))))),r.a.createElement(d.a,{md:12},r.a.createElement(b.a,null,r.a.createElement(b.a.Header,null,r.a.createElement(b.a.Title,{as:"h5"},"Listado de Gastos ",r.a.createElement(f.a,{key:"btnBack",variant:"success",size:"sm",onClick:function(e){X(!W)}},"Mostrar"))),!0===W&&r.a.createElement(b.a.Body,null,r.a.createElement(w,{handleEditar:function(e){var t=N.find((function(t){return t.gastoId===e})),a=t.gastoId,n=t.categoriaId,r=t.sub_categoriaId,c=t.descripcion,o=t.monto,s=t.estadoId;he({gastoId:a,categoriaId:n,sub_categoriaId:r,descripcion:c,monto:o,estadoId:s}),ie(!0)},listGastos:N,setListGastos:I,setshowListGasto:X,listCategorias:ee,listSubCategorias:re,setLoading:c})))),r.a.createElement(A,{listUnificacionGastosPresupuesto:R}),r.a.createElement(P,{listGastos:N,values:be,listPresupuesto:M})))),!0===le&&r.a.createElement(D,{setRefreshData:h,setAbrirModal:ie,abrirModal:le,dataInicial:Ee,listCategorias:ee,listSubCategorias:re}))},L=function(e){var t=e.texto,a=e.presupuesto,c=e.gasto,o=Object(n.useState)(0),s=Object(l.a)(o,2),i=s[0],u=s[1],m=Object(n.useState)("success"),d=Object(l.a)(m,2),b=d[0],f=d[1],g=["success","warning","danger"];return Object(n.useEffect)((function(){var e=Number(c)/Number(a);Number.isFinite(e)?(e=Number(100*e).toFixed(0),u(e)):u(100)}),[]),Object(n.useEffect)((function(){f(i>0?i<=70?g[0]:i<=95?g[1]:g[2]:g[2])}),[i]),r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{className:"text-muted mb-2"},t," (Q",Number(c).toFixed(2),"/",Number(a).toFixed(2),")",r.a.createElement("span",{className:"float-right"},i,"%(Q",Number(c).toFixed(2),")")),r.a.createElement(p.a,{variant:b,now:i}))},A=function(e){var t=e.listUnificacionGastosPresupuesto,a=void 0===t?[]:t,c=Object(n.useState)([]),o=Object(l.a)(c,2),s=o[0],i=o[1],u=Object(n.useState)([]),m=Object(l.a)(u,2),f=m[0],p=m[1];Object(n.useEffect)((function(){if(a.length>0){var e=[],t=[];a.map((function(a){var n=a.categoria,r=a.gasto;e.push(String(n)),t.push(Number(r))})),i(e),p(t)}}),[a]);return r.a.createElement(d.a,{md:12},r.a.createElement(b.a,null,r.a.createElement(b.a.Header,null,r.a.createElement(b.a.Title,{as:"h5"},"Gastos por Categor\xeda")),r.a.createElement(b.a.Body,null,r.a.createElement(h.a,{height:320,type:"donut",options:{colors:["#4680ff","#0e9e4a","#00acc1","#ffa21d","#ff5252","#ff2364","#00cccc","#000fff","#0ef9ef","#ffa24e"],legend:{show:!0,position:"bottom"},labels:s,plotOptions:{pie:{donut:{labels:{show:!0,name:{show:!0},value:{show:!0}}}}},dataLabels:{enabled:!0,dropShadow:{enabled:!1}},responsive:[{breakpoint:480,options:{chart:{width:200},legend:{position:"bottom"}}}]},series:f}))))},P=function(e){var t=e.listGastos,a=void 0===t?[]:t,c=e.listPresupuesto,o=void 0===c?[]:c,s=e.values,i=Object(n.useState)([]),m=Object(l.a)(i,2),f=m[0],p=m[1],g=Object(n.useState)([]),E=Object(l.a)(g,2),v=E[0],O=E[1],j=Object(n.useState)([]),N=Object(l.a)(j,2),I=N[0],x=N[1],y=Object(n.useState)([]),Y=Object(l.a)(y,2),S=Y[0],w=Y[1],M=Object(n.useState)([]),F=Object(l.a)(M,2),C=F[0],k=F[1];Object(n.useEffect)((function(){for(var e=[],t=Number(u()(s.fechaInicial,"YYYY-MM-DD").format("MM")),a=Number(u()(s.fechaInicial,"YYYY-MM-DD").format("YYYY")),n=Number(u()(s.fechaFinal,"YYYY-MM-DD").format("MM")),r=Number(u()(s.fechaFinal,"YYYY-MM-DD").format("YYYY")),c=a;c<=r;c++){var o=12,l=1;c===r&&(o=n),c===a&&(l=t);for(var i=l;i<=o;i++){var m={};m.anioId=c,m.mesId=i,e.push(m)}}p(e)}),[a]),Object(n.useEffect)((function(){if(a.length>0){var e=[];f.map((function(t){var n=t.anioId,r=t.mesId,c={};c.anioId=Number(n),c.mesId=Number(r);var s=a.filter((function(e){return Number(e.anioId)===Number(n)&&Number(e.mesId)===Number(r)})),l=o.filter((function(e){return Number(e.anio)===Number(n)&&Number(e.mesId)===Number(r)}));c.gasto=parseInt(s.reduce((function(e,t){return e+Number(t.monto)}),0)),c.presupuesto=parseInt(l.reduce((function(e,t){return e+Number(t.monto)}),0)),e.find((function(e){return Number(e.anioId)===Number(n)&&Number(e.mesId)===Number(r)}))||e.push(c)})),console.log({list:e}),O(e)}else O([])}),[f]),Object(n.useEffect)((function(){if(v.length>0){var e=[],t=[],a=[];v.map((function(n){var r=n.anioId,c=n.mesId,o=n.presupuesto,s=n.gasto;t.push(s),a.push(o),c<10?e.push("0".concat(c,"/").concat(String(r).substring(2,4))):e.push("".concat(c,"/").concat(String(r).substring(2,4)))})),x(e),w(t),k(a)}}),[v]);var D={height:350,type:"line",options:{dataLabels:{enabled:!1},stroke:{width:[0,4]},colors:["#4680ff","#ff5252"],title:{text:"Presupuesto vrs Gasto"},labels:I,xaxis:{},yaxis:[{title:{text:"Presupuesto"}},{opposite:!0,title:{text:"Gasto"}}],tooltip:{y:{formatter:function(e){return"Q"+parseFloat(e).toFixed(2)}}}},series:[{name:"Presupuesto",type:"column",data:C},{name:"Gasto",type:"line",data:S}]};return r.a.createElement(d.a,{md:12},r.a.createElement(b.a,null,r.a.createElement(b.a.Header,null,r.a.createElement(b.a.Title,{as:"h5"},"Presupuesto vrs Gasto")),r.a.createElement(b.a.Body,null,r.a.createElement(h.a,D))))};t.default=function(){return r.a.createElement(G,null)}}}]);
//# sourceMappingURL=31.6e6def84.chunk.js.map